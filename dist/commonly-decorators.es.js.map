{"version":3,"file":"commonly-decorators.es.js","sources":["../src/lib/freeze.ts","../src/lib/miniprogram/Assemble.ts","../src/lib/common/param.ts","../src/index.ts"],"sourcesContent":["import freezeClick from \"freeze-click\";\n\nexport default function freeze(maxTimeout = 10000) {\n  return function closureFn(\n    target: any,\n    property: string,\n    descriptor: PropertyDescriptor,\n  ) {\n    const fn = descriptor.value;\n\n    descriptor.value = freezeClick(async function newFn(\n      this: any,\n      fc,\n      ...opts\n    ) {\n      try {\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      } finally {\n        fc.cancel();\n      }\n    }, maxTimeout);\n  };\n}\n","interface IInject {\n  new (...opts: any[]): any;\n}\n\nexport function Assemble(\n  key: string,\n  constructor: IInject,\n  constructorArgs?: string[],\n) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn(...opts: any[]) {\n        try {\n          const args =\n            (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) ||\n            [];\n          this[property] = new constructor(...args);\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        const args =\n          (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) || [];\n        this[property] = new constructor(...args);\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n\nexport function AssembleValue<IValue = unknown>(key: string, value: IValue) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn() {\n        try {\n          this[property] = value;\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        this[property] = value;\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n","export function Required(\n  errMsg: string,\n  propertyPath = \"\",\n): ParameterDecorator {\n  return function _required(\n    target: any,\n    property: string | symbol,\n    parameterIndex: number,\n  ): void {\n    if (!target?.__requiredData) {\n      target.__requiredData = new Map();\n    }\n    target.__requiredData.set(property, {\n      index: parameterIndex,\n      errMsg,\n      propertyPath,\n    });\n  };\n}\n\nexport class ParameterDecoratorError extends Error {\n  __id = \"ParameterDecoratorError\";\n\n  private status = \"PARAM_ERROR\";\n\n  private data = null;\n\n  private from = \"CheckParamRequired\";\n\n  constructor(msg: string) {\n    super(msg);\n  }\n\n  setData(val: any) {\n    this.data = val;\n  }\n\n  getData() {\n    return this.data;\n  }\n\n  setStatus(status: string) {\n    this.status = status;\n  }\n\n  getStatus() {\n    return this.status;\n  }\n\n  setFrom(from: string) {\n    this.from = from;\n  }\n\n  getFrom() {\n    return this.from;\n  }\n\n  static isParameterDecoratorError(obj: any) {\n    return (\n      obj instanceof ParameterDecoratorError ||\n      obj?.__id === new ParameterDecoratorError(\"\").__id\n    );\n  }\n}\n\nexport function CheckParamRequired(\n  target: any,\n  property: string,\n  propertyDescriptor: PropertyDescriptor,\n) {\n  const originalFn = propertyDescriptor.value;\n  propertyDescriptor.value = async function (...opts: any[]) {\n    const requiredData: Map<\n      string,\n      {\n        index: number;\n        errMsg: string;\n        propertyPath: string;\n      }\n    > = target?.__requiredData;\n    const requiredInfo = requiredData.get(property);\n    const index = Number(requiredInfo?.index);\n    const propertyPath = requiredInfo?.propertyPath;\n    const propertyPaths = propertyPath?.split(\".\") || [];\n    const val = propertyPaths.reduce((pre: any, pathKey: any) => {\n      if (typeof pre === \"undefined\" || pre === null) {\n        return pre;\n      }\n\n      if ((!pathKey && pathKey !== 0) || pathKey === \".\") {\n        return pre;\n      }\n      return pre?.[pathKey];\n    }, opts?.[index]);\n\n    if (\n      !isNaN(index) &&\n      (typeof val === \"undefined\" || val === \"\" || val === null)\n    ) {\n      throw new ParameterDecoratorError(\n        requiredInfo?.errMsg || `第${index + 1}个参数必传`,\n      );\n    }\n\n    const result = await originalFn.apply(this, opts);\n\n    return result;\n  };\n}\n\nexport default {\n  Required,\n  CheckParamRequired,\n  ParameterDecoratorError,\n};\n","import freeze from \"./lib/freeze\";\nimport * as miniprogram from \"./lib/miniprogram\";\nexport * from \"./lib/miniprogram\";\nexport * from \"./lib/common\";\n\nexport { freeze };\n\nexport default {\n  freeze,\n  miniprogram,\n};\n"],"names":[],"mappings":"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"}