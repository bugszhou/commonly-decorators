{"version":3,"file":"commonly-decorators.min.js","sources":["../src/lib/freeze.ts","../src/lib/miniprogram/Assemble.ts","../src/lib/common/param.ts","../src/index.ts"],"sourcesContent":["import freezeClick from \"freeze-click\";\n\nexport default function freeze(maxTimeout = 10000) {\n  return function closureFn(\n    target: any,\n    property: string,\n    descriptor: PropertyDescriptor,\n  ) {\n    const fn = descriptor.value;\n\n    descriptor.value = freezeClick(async function newFn(\n      this: any,\n      fc,\n      ...opts\n    ) {\n      try {\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      } finally {\n        fc.cancel();\n      }\n    }, maxTimeout);\n  };\n}\n","interface IInject {\n  new (...opts: any[]): any;\n}\n\nexport function Assemble(\n  key: string,\n  constructor: IInject,\n  constructorArgs?: string[],\n) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn(...opts: any[]) {\n        try {\n          const args =\n            (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) ||\n            [];\n          this[property] = new constructor(...args);\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        const args =\n          (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) || [];\n        this[property] = new constructor(...args);\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n\nexport function AssembleValue<IValue = unknown>(key: string, value: IValue) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn() {\n        try {\n          this[property] = value;\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        this[property] = value;\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n","export function Required(errMsg: string, propertyPath = \"\"): ParameterDecorator {\n  return function _required(\n    target: any,\n    property: string | symbol,\n    parameterIndex: number,\n  ): void {\n    if (!target?.__requiredData) {\n      target.__requiredData = new Map();\n    }\n    target.__requiredData.set(property, {\n      index: parameterIndex,\n      errMsg,\n      propertyPath,\n    });\n  };\n}\n\nexport function CheckParamRequired(\n  target: any,\n  property: string,\n  propertyDescriptor: PropertyDescriptor,\n) {\n  const originalFn = propertyDescriptor.value;\n  propertyDescriptor.value = async function (...opts: any[]) {\n    const requiredData: Map<\n      string,\n      {\n        index: number;\n        errMsg: string;\n        propertyPath: string;\n      }\n    > = target?.__requiredData;\n    const requiredInfo = requiredData.get(property);\n    const index = Number(requiredInfo?.index);\n    const propertyPath = requiredInfo?.propertyPath;\n    const propertyPaths = propertyPath?.split(\".\") || [];\n    const val = propertyPaths.reduce((pre: any, pathKey: any) => {\n      if (pre ?? true) {\n        return pre;\n      }\n\n      if ((!pathKey && pathKey !== 0) || pathKey === \".\") {\n        return pre;\n      }\n      return pre?.[pathKey];\n    }, opts?.[index]);\n\n    if (val ?? true) {\n      throw new TypeError(requiredInfo?.errMsg || `第${index + 1}个参数必传`);\n    }\n\n    if (!isNaN(index) && (opts?.[index] ?? true)) {\n      throw {\n        status: \"PARAM_ERROR\",\n        msg: requiredInfo?.errMsg || `第${index + 1}个参数必传`,\n        data: null,\n        from: \"CheckParamRequired\",\n      };\n    }\n\n    const result = await originalFn.apply(this, opts);\n\n    return result;\n  };\n}\n\nexport default {\n  Required,\n  CheckParamRequired,\n};\n","import freeze from \"./lib/freeze\";\nimport * as miniprogram from \"./lib/miniprogram\";\nexport * from \"./lib/miniprogram\";\nexport * from \"./lib/common\";\n\nexport { freeze };\n\nexport default {\n  freeze,\n  miniprogram,\n};\n"],"names":["freeze","maxTimeout","target","property","descriptor","fn","value","freezeClick","fc","opts","_i","arguments","length","apply","this","_a","sent","cancel","Assemble","key","constructor","constructorArgs","then","args","map","item","__spreadArray","e","console","error","AssembleValue","param","Required","errMsg","propertyPath","parameterIndex","__requiredData","Map","set","index","CheckParamRequired","propertyDescriptor","originalFn","requiredData","requiredInfo","get","Number","propertyPaths","split","val","reduce","pre","pathKey","TypeError","concat","isNaN","status","msg","data","from","_b","miniprogram","Object","__proto__","exports","ParamDecorator","defineProperty"],"mappings":"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"}