{"version":3,"file":"commonly-decorators.min.js","sources":["../src/lib/freeze.ts","../src/lib/miniprogram/Assemble.ts","../src/lib/common/param.ts","../src/index.ts"],"sourcesContent":["import freezeClick from \"freeze-click\";\n\nexport default function freeze(maxTimeout = 10000) {\n  return function closureFn(\n    target: any,\n    property: string,\n    descriptor: PropertyDescriptor,\n  ) {\n    const fn = descriptor.value;\n\n    descriptor.value = freezeClick(async function newFn(\n      this: any,\n      fc,\n      ...opts\n    ) {\n      try {\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      } finally {\n        fc.cancel();\n      }\n    }, maxTimeout);\n  };\n}\n","interface IInject {\n  new (...opts: any[]): any;\n}\n\nexport function Assemble(\n  key: string,\n  constructor: IInject,\n  constructorArgs?: string[],\n) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn(...opts: any[]) {\n        try {\n          const args =\n            (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) ||\n            [];\n          this[property] = new constructor(...args);\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        const args =\n          (opts[0] ? constructorArgs?.map((item) => opts[0][item]) : []) || [];\n        this[property] = new constructor(...args);\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n\nexport function AssembleValue<IValue = unknown>(key: string, value: IValue) {\n  return function closureFn(target: any, property: string) {\n    const fn = target[key];\n\n    if (typeof fn !== \"function\" && typeof fn?.then !== \"function\") {\n      target[key] = async function newFn() {\n        try {\n          this[property] = value;\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      return;\n    }\n\n    target[key] = async function newFn(...opts: any[]) {\n      try {\n        this[property] = value;\n        const result = await fn.apply(this, opts);\n        return result;\n      } catch (e) {\n        throw e;\n      }\n    };\n  };\n}\n","export function Required(\n  errMsg: string,\n  propertyPath = \"\",\n): ParameterDecorator {\n  return function _required(\n    target: any,\n    property: string | symbol,\n    parameterIndex: number,\n  ): void {\n    if (!target?.__requiredData) {\n      target.__requiredData = new Map();\n    }\n    target.__requiredData.set(property, {\n      index: parameterIndex,\n      errMsg,\n      propertyPath,\n    });\n    if (!property) {\n      return;\n    }\n    const originalFn = target[property];\n    target[property] = async function (...opts: any[]) {\n      const requiredData: Map<\n        string,\n        {\n          index: number;\n          errMsg: string;\n          propertyPath: string;\n        }\n      > = target?.__requiredData;\n      const requiredInfo = requiredData.get(property as string);\n      const index = Number(requiredInfo?.index);\n      const propertyPath = requiredInfo?.propertyPath;\n      const propertyPaths = propertyPath?.split(\".\") || [];\n      const val = propertyPaths.reduce((pre: any, pathKey: any) => {\n        if (typeof pre === \"undefined\" || pre === null) {\n          return pre;\n        }\n  \n        if ((!pathKey && pathKey !== 0) || pathKey === \".\") {\n          return pre;\n        }\n        return pre?.[pathKey];\n      }, opts?.[index]);\n  \n      if (\n        !isNaN(index) &&\n        (typeof val === \"undefined\" || val === \"\" || val === null)\n      ) {\n        throw new ParameterDecoratorError(\n          requiredInfo?.errMsg || `第${index + 1}个参数必传`,\n        );\n      }\n  \n      const result = await originalFn.apply(this, opts);\n  \n      return result;\n    };\n  };\n}\n\nexport class ParameterDecoratorError extends Error {\n  __id = \"ParameterDecoratorError\";\n\n  private status = \"PARAM_ERROR\";\n\n  private data = null;\n\n  private from = \"CheckParamRequired\";\n\n  constructor(msg: string) {\n    super(msg);\n  }\n\n  setData(val: any) {\n    this.data = val;\n  }\n\n  getData() {\n    return this.data;\n  }\n\n  setStatus(status: string) {\n    this.status = status;\n  }\n\n  getStatus() {\n    return this.status;\n  }\n\n  setFrom(from: string) {\n    this.from = from;\n  }\n\n  getFrom() {\n    return this.from;\n  }\n\n  static isParameterDecoratorError(obj: any) {\n    return (\n      obj instanceof ParameterDecoratorError ||\n      obj?.__id === new ParameterDecoratorError(\"\").__id\n    );\n  }\n}\n\nexport function CheckParamRequired(\n  target: any,\n  property: string,\n  propertyDescriptor: PropertyDescriptor,\n) {\n  const originalFn = propertyDescriptor.value;\n  propertyDescriptor.value = async function (...opts: any[]) {\n    const requiredData: Map<\n      string,\n      {\n        index: number;\n        errMsg: string;\n        propertyPath: string;\n      }\n    > = target?.__requiredData;\n    const requiredInfo = requiredData.get(property);\n    const index = Number(requiredInfo?.index);\n    const propertyPath = requiredInfo?.propertyPath;\n    const propertyPaths = propertyPath?.split(\".\") || [];\n    const val = propertyPaths.reduce((pre: any, pathKey: any) => {\n      if (typeof pre === \"undefined\" || pre === null) {\n        return pre;\n      }\n\n      if ((!pathKey && pathKey !== 0) || pathKey === \".\") {\n        return pre;\n      }\n      return pre?.[pathKey];\n    }, opts?.[index]);\n\n    if (\n      !isNaN(index) &&\n      (typeof val === \"undefined\" || val === \"\" || val === null)\n    ) {\n      throw new ParameterDecoratorError(\n        requiredInfo?.errMsg || `第${index + 1}个参数必传`,\n      );\n    }\n\n    const result = await originalFn.apply(this, opts);\n\n    return result;\n  };\n}\n\nexport default {\n  Required,\n  CheckParamRequired,\n  ParameterDecoratorError,\n};\n","import freeze from \"./lib/freeze\";\nimport * as miniprogram from \"./lib/miniprogram\";\nexport * from \"./lib/miniprogram\";\nexport * from \"./lib/common\";\n\nexport { freeze };\n\nexport default {\n  freeze,\n  miniprogram,\n};\n"],"names":["freeze","maxTimeout","target","property","descriptor","fn","value","freezeClick","fc","opts","_i","arguments","length","apply","this","_a","sent","cancel","Assemble","key","constructor","constructorArgs","then","args","map","item","__spreadArray","e","console","error","AssembleValue","miniprogram","Object","__proto__","ParameterDecoratorError","_super","msg","_this","call","__id","status","data","from","__extends","prototype","setData","val","getData","setStatus","getStatus","setFrom","getFrom","isParameterDecoratorError","obj","Error","param","Required","errMsg","propertyPath","parameterIndex","__requiredData","Map","set","index","originalFn","requiredData","requiredInfo","get","Number","propertyPaths","split","reduce","pre","pathKey","isNaN","concat","CheckParamRequired","propertyDescriptor","exports","ParamDecorator","defineProperty"],"mappings":"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"}